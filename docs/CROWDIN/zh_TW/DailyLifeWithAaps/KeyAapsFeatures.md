# AAPS 的主要功能

(Open-APS-features-autosens)=

## 自動敏感度調整 (Autosens)

- Autosens 是一種算法，可以觀察血糖的偏差（正/負/中性）。
- 他會根據這些偏差，試圖找出你對胰島素的敏感度或抗性。
- 在 **OpenAPS** 中的 oref 實作，基於過去 24 小時和 8 小時的資料運作。 他會使用其中較敏感的資料來進行調整。
- 在**AAPS 2.7**之前的版本中，用戶必須手動選擇 8 或 24 小時。
- 從**AAPS 2.7**開始，Autosens 在**AAPS**中將在 24 小時和 8 小時窗口之間切換以計算敏感度。 它將選擇較為敏感的那一種。 
- 如果用戶曾經使用過 oref1，他們可能會注意到系統對變化的反應可能不如預期動態，這是由於 24 小時或 8 小時敏感度的不同。
- 更換套管或更改設定檔時，會將 Autosens 比例重置回 100%（設定檔持續時間切換不會重置 Autosens）。
- Autosens 會調整你的基礎胰島素和胰島素敏感因子（ISF），模仿設定檔切換的效果。
- 如果在一段延長的時間內不斷攝取碳水化合物，Autosens 在該期間的效果會較差，因為碳水化合物不包括在**BG**變化量的計算中。

(Open-APS-features-super-micro-bolus-smb)=

## 超微量注射 (Super Micro Bolus, SMB)

**SMB**，**超微量注射**的簡稱，是自 2018 年起於 Oref1 算法中引入的 OpenAPS 功能。 與**AMA**不同，**SMB**並不使用臨時基礎率來控制葡萄糖水平，而主要使用**小型超微量注射**。 在**AMA**會使用臨時基礎率添加 1.0 IU 胰島素的情況下，**SMB**則會以**5 分鐘的間隔**在小步驟中提供多次超微量注射，例如 0.4 IU、0.3 IU、0.2 IU 和 0.1 IU。 同時（為了安全），實際基礎率會在一段時間內設為 0 IU/h，以防止過量注射（稱為 **“零臨時基礎率”**）。 這使得系統能夠比**AMA**中的臨時基礎率增加更快速地調整血糖。

感謝 SMB，對於僅含“緩慢”碳水化合物的餐點，可能只需通知系統計畫中的碳水化合物量，並將其餘的留給**AAPS**。 然而，這可能會導致餐後血糖高峰，因為無法提前注射。 或者如果有必要的話，你可以進行預先注射，給予**開始注射**，此注射**僅部分**覆蓋碳水化合物（例如預估量的 2/3），並讓**SMB**提供其餘的胰島素。

![SMBs 在主圖中顯示](../images/SMBs.png)

SMBs 以藍色三角形的形式顯示在主圖中。 點擊三角形可以查看注射的胰島素量，或使用 [治療選單](#aaps-screens-treatments)。

**SMB 的** 功能包含一些安全機制：

1. **單次最大的 SMB 劑量**  
    單次最大的 SMB 劑量只能是以下最小值：
    
    - 基於目前基礎率（由 Autosens 調整）的數值，對應於 "限制 SMB 的最大臨時基礎率分鐘數" 中設定的持續時間，例如接下來 30 分鐘的基礎量，或
    - 目前所需胰島素量的一半，或
    - 設定中的最大可用胰島素 (maxIOB) 剩餘部分。

2. **低臨時基礎速率**  
    低臨時基礎速率（稱為「低臨時」）或臨時基礎速率為 0 U/h（稱為「零臨時」）在 **SMB** 中會更常被啟動。 這是出於安全理由的設計，若 **設定檔** 正確設定，則沒有任何負面影響。 在主圖上，IOB 曲線（黃色細線）比臨時基礎速率的變化更有意義。

3. **未通報的餐點**  
    額外計算以預測血糖的變化，例如透過 **UAM**（未通報的餐點）。 即使用戶未手動輸入碳水化合物，**UAM** 也能自動檢測因餐點、腎上腺素或其他影響導致的血糖水平顯著上升，並嘗試透過 **SMB** 進行調整。 為了安全起見，這也能反向運作，如果血糖意外快速下降，系統可以提前停止 SMB。 這就是為什麼 UAM 應該在 SMB 中始終處於啟用狀態的原因。

**你必須開始使用[目標 9](#objectives-objective9)來使用 SMB。**

另請參見：

- [OpenAPS 關於 SMB 的文件](https://openaps.readthedocs.io/en/latest/docs/Customize-Iterate/oref1.html#understanding-super-micro-bolus-smb)。
- [OpenAPS oref1 SMB 的文件](https://openaps.readthedocs.io/en/latest/docs/Customize-Iterate/oref1.html)
- [Tim 關於 SMB 的資訊](https://www.diabettech.com/artificial-pancreas/understanding-smb-and-oref1/)。

OpenAPS SMB 的設定如下。

(Open-APS-features-max-u-h-a-temp-basal-can-be-set-to)=

### 臨時基礎可以設置的最大 U/h

此安全設定決定了胰島素幫浦所能提供的最大臨時基礎率。 這也被稱為 **最大基礎**。

該值以每小時單位（U/h）測量。 建議將此設為合理的數值。 設置此參數的良好建議為：

    最大基礎 = 最高基礎速率 x 4
    

例如，如果你的最高基礎率為0.5 U/h，你可以將其乘以4得到2 U/h的值。

**AAPS** 將此值限制為根據 [偏好設定 > 治療安全 > 患者類型](#preferences-patient-type) 的「硬限制」。 硬限制如下：

- 兒童：2
- 青少年：5
- 成人：10
- 胰島素抗性成人：12
- 孕婦：25

*請參閱 [硬性限制概述](#overview-of-hard-coded-limits)。*

(Open-APS-features-maximum-total-iob-openaps-cant-go-over)=

### 最大總 IOB 的 OpenAPS 不能超過

此值決定了在閉環模式運行時 **AAPS** 所維持的最大 **在體胰島素**（基礎和注射 IOB）。 這也被稱為 **最大 IOB**。

如果目前的 IOB（例如餐後注射）超過了設定值，循環將暫停胰島素注射，直到 IOB 降至設定的限制值以下。

設置此參數的良好開始是：

    最大 IOB = 平均餐食注射量 + 每日最大基礎率的 3 倍
    

在調整你的 **最大 IOB** 時要小心並保持耐心。 每個人的情況都不同，這也可能取決於每日總劑量 (TDD) 的平均值。

**AAPS** 將此值限制為根據 [偏好設定 > 治療安全 > 患者類型](#preferences-patient-type) 的「硬限制」。 硬限制如下：

- 兒童：3
- 青少年：7
- 成人：12
- 胰島素抗性成人：25
- 孕婦：40

*請參閱 [硬性限制概述](#overview-of-hard-coded-limits)。*

注意：在使用 **SMB** 時，**最大 IOB** 的計算方式與 AMA 不同。 在 **AMA** 中，最大 IOB 是基礎 **IOB** 的安全參數，而在 SMB 模式中，還包括注射 IOB。

另見 [OpenAPS 的 SMB 文件](https://openaps.readthedocs.io/en/latest/docs/Customize-Iterate/oref1.html#understanding-super-micro-bolus-smb)。

### 啟用動態靈敏度

這是[動態 ISF](../DailyLifeWithAaps/DynamicISF.md) 功能。 當啟用時，將提供新的設定。 設定說明請參見[動態 ISF](#dyn-isf-preferences)頁面。

#### 高臨時目標提升敏感度

如果啟用了此選項，當臨時目標高於 100 mg/dl 或 5.6 mmol/l 時，胰島素敏感度將會增加。 這意味著，胰島素敏感因子（ISF）會上升，而胰島素碳水化合物比（IC）和基礎率會下降。 這將使得 **AAPS** 在你設置高臨時目標時變得不那麼積極。

#### 低臨時目標降低敏感度

如果啟用了此選項，當臨時目標低於 100 mg/dl 或 5.6 mmol/l 時，胰島素敏感度將會下降。 這意味著，胰島素敏感因子（ISF）會下降，而胰島素碳水化合物比（IC）和基礎率會上升。 這將使得 **AAPS** 在你設置低臨時目標時變得更加積極。

### 啟用自動敏感度調整功能

這是[自動敏感度調整](#autosens)功能。 在使用動態 ISF 時，不能使用自動敏感度調整，因為這是兩種不同的算法，會影響相同的變數（敏感度）。

Autosens 會根據血糖偏差（正/負/中性）進行調整。 他會根據這些偏差計算出你對胰島素的敏感度或抗性，並根據偏差調整基礎速率和胰島素敏感指數（ISF）。

當啟用時，將提供新的設定。

### 敏感度提升目標

如果啟用了此選項，敏感度偵測（autosens）可以在偵測到胰島素敏感度增強（低於 100%）時提高目標值。 在這種情況下，目標值將根據偵測到的敏感度百分比提高。

如果因為敏感度檢測而修改目標，則會在你的主螢幕上以綠色背景顯示。

![Autosens 修改目標](../images/Home2020_DynamicTargetAdjustment.png)

當“啟用動態敏感度”或“啟用自動敏感度調整功能”中的一個被啟用時，此設定可用。

### 抗性降低目標

如果啟用了此選項，敏感度偵測（autosens）可以在偵測到胰島素抗性增加（高於 100%）時降低目標值。 在這種情況下，目標值將根據偵測到的抗性百分比降低。

當“啟用動態敏感度”或“啟用自動敏感度調整功能”中的一個被啟用時，此設定可用。

### 啟用 SMB

啟用此選項以使用 SMB 功能。 如果停用，將不會給予任何 **SMB**。

當啟用時，將提供新的設定。

(Open-APS-features-enable-smb-with-high-temp-targets)=

#### 啟用具有高臨時目標的 SMB

如果此設定啟用，即使用戶選擇高 **臨時目標**（定義為任何高於 100mg/dL 或 5.6mmol/l 的值，與 **設定檔** 的目標無關），**SMB** 仍然會被給予。 此選項主要在停用時禁止 SMB。 例如，如果這個選項停用，可以透過將臨時目標設置在 100mg/dL 或 5.6mmol/l 以上來停用 **SMB**。 此選項也將停用 **SMB**，無論其他條件如何嘗試啟用 SMB。

如果此設定啟用，只有當 **啟用臨時目標的 SMB** 也啟用時，**SMB** 才會在高臨時目標下啟用。

(Open-APS-features-enable-smb-always)=

#### 始終啟用 SMB

如果此設定啟用，SMB 將始終啟用（獨立於 COB、臨時目標或注射）。 如果啟用了此設定，下方的其他啟用設定將不再生效。 但是，如果 **啟用高臨時目標的 SMB** 被停用且設置了高臨時目標，則 **SMB** 將被停用。

此設定僅在**AAPS** 偵測到您正在使用[可靠的血糖來源](#GettingStarted-TrustedBGSource)且具有進階過濾功能時可用。 由於在傳感器故障的情況下舊的血糖資料可能會無限重複，因此 FreeStyle Libre 1 不被視為可靠來源。

干擾的資料可能會使**AAPS**認為血糖正在快速上升，導致不必要的SMB。 有關干擾和資料平滑的更多資訊，請參見[這裡](../CompatibleCgms/SmoothingBloodGlucoseData.md).

#### 啟用具有 COB 的 SMB

如果啟用了此設定，當 COB 大於 0 時，SMB 將會啟用。

如果“始終啟用SMB”開啟，此設定將不會顯示。

#### 啟用具有臨時目標的 SMB

如果啟用了此設定，當設置任何臨時目標時（如即將用餐、運動、低血糖、自訂），SMB 將會啟用。 如果啟用此設定但 **啟用高臨時目標的 SMB** 被停用，當設置低臨時目標（低於 100mg/dL 或 5.6mmol/l）時，SMB 將啟用，但當設置高臨時目標時則會停用。

如果“始終啟用SMB”開啟，此設定將不會顯示。

#### 啟用碳水後的 SMB

如果啟用了此設定，在碳水化合物被紀錄後的 6 小時內，即使 COB 已降至 0，SMB 仍會啟用。

出於安全原因，唯有**AAPS**檢測到你正在使用可靠的血糖來源，該設定才會顯示。 如果“始終啟用SMB”開啟，該設定將不會顯示。

此設定僅在**AAPS** 偵測到您正在使用[可靠的血糖來源](#GettingStarted-TrustedBGSource)且具有進階過濾功能時可用。 由於在傳感器故障的情況下舊的血糖資料可能會無限重複，因此 FreeStyle Libre 1 不被視為可靠來源。

干擾的資料可能會使**AAPS**認為血糖正在快速上升，導致不必要的SMB。 有關干擾和資料平滑的更多資訊，請參見[這裡](../CompatibleCgms/SmoothingBloodGlucoseData.md)。  
如果“始終啟用 SMB”開啟，則此設定不會顯示。

#### SMB 執行的最小間隔時間（分鐘）

此功能限制了 SMB 的頻率。 此數值決定了 SMB 之間的最小間隔時間。 注意，每當收到新的血糖數值（通常為每 5 分鐘一次）時，循環便會執行一次。 減去 2 分鐘以給循環更多時間完成。 例如，如果你希望每次循環運行都給予 SMB，則將這個設置為 3 分鐘。

預設值：3 分鐘。

(Open-APS-features-max-minutes-of-basal-to-limit-smb-to)=

#### 限制 SMB 的最大基礎率時間（分鐘）

這是一個重要的安全設定。 此數值決定了在 COB 覆蓋的情況下，SMB 可以根據設定的基礎胰島素在給定時間內注射多少。

將此數值設得較大可以使 SMB 更積極。 建議以 30 分鐘的預設值開始。 有了經驗後，可以每次增加 15 分鐘，並觀察多次用餐後的效果。

建議不要將此數值設置為超過 90 分鐘，因為這可能會導致演算法無法應對基礎率為 0 U/h（零臨時基礎率）的血糖下降情況。 特別是在你還在測試新設定時，應設置警報，這樣可以在低血糖發生之前提前發出警告。

預設值：30 分鐘。

#### 限制UAM SMB的最大基礎分鐘數

此設定允許調整在無碳水化合物狀態下，進行未宣告餐點（UAM）時超微量注射（SMB）的強度。

預設值：與**最大基礎時間限制微量注射**相同。

僅當“啟用 SMB”和“啟用 UAM”都開啟時，此設定才顯示。

### 啟用 UAM

啟用此選項後，SMB 演算法可以識別未宣告的餐點。 這對於你忘記告訴 **AAPS** 有關碳水化合物或估算錯誤的情況非常有幫助，因為輸入的碳水化合物數量不正確，或者如果含有大量脂肪和蛋白質的餐點持續時間超過預期。 在沒有任何碳水輸入的情況下，UAM 可以識別由碳水化合物、腎上腺素等引起的快速血糖升高，並嘗試使用 SMB 進行調整。 這也可以反向運作：如果血糖快速下降，他可以提前停止 SMB。

**因此，當使用 SMB 時，UAM 應該始終啟用。**

(key-aaps-features-minimal-carbs-required-for-suggestion)=

### 建議所需的最少碳水化合物

顯示碳水化合物建議警報所需的最少克數。 當系統偵測到需要碳水化合物時，會建議需要額外的碳水化合物。 在此情況下，你會收到一個可以延後 5、15 或 30 分鐘的通知。

如果有需要，碳水化合物需求通知可以推送到 Nightscout，屆時會顯示並廣播公告。

無論如何，所需的碳水化合物將在你的主螢幕上的 COB 部分顯示。

![在主畫面顯示所需的碳水化合物量](../images/Pref2020_CarbsRequired.png)

### 進階設定

你可以在這裡閱讀更多資訊：[OpenAPS 文件](https://openaps.readthedocs.io/en/latest/docs/While%20You%20Wait%20For%20Gear/preferences-and-safety-settings.html).

**總是使用短期平均變化率而非簡單資料** 如果你啟用此功能，**AAPS** 將使用過去 15 分鐘內的短期平均變化率/血糖，這通常是最後三個數值的平均值。 這有助於**AAPS**在處理像 xDrip+ 和 Libre 這樣的干擾資料來源時保持穩定。

**每日安全倍數上限** 這是一個重要的安全限制。 預設值為 3（通常不需要調整）。 這意味著**AAPS**將永遠不能設定超過用戶的幫浦和/或設定檔中最高每小時基礎率 3 倍的臨時基礎率。 舉例來說：如果你的最高基礎率是 1.0 U/h ，且每日安全增益上限為 3，那麼**AAPS**可以設定的臨時基礎率上限為 3.0 U/h (= 3 x 1.0 U/h)。

預設值：3（除非你確實知道需要更改，否則不應更改此設定）。

**目前基礎率安全倍數** 這是另一個重要的安全限制。 預設值為 4（通常也不需要調整）。 這意味著**AAPS**將永遠不能設定超過用戶的幫浦和/或設定檔中每小時基礎率 4 倍的臨時基礎率。

預設值：4（除非你確實知道需要更改，否則不應更改此設定）。

* * *

(Open-APS-features-advanced-meal-assist-ama)=

## 進階餐食輔助 (AMA)

AMA 是 "進階餐食輔助" 的縮寫，是 2017 年 OpenAPS 的一項功能（oref0）。 OpenAPS 進階餐食輔助 (AMA) 允許系統在餐後注射後更快地提高臨時基礎率，前提是你可靠地輸入了碳水化合物。

你可以在 [OpenAPS 文件](https://newer-docs.readthedocs.io/en/latest/docs/walkthrough/phase-4/advanced-features.html#advanced-meal-assist-or-ama) 中找到更多資訊。

### 臨時基礎率的最大 U/h (OpenAPS "最大基礎率")

這個安全設置有助於防止**AAPS**給予危險的高基礎率，並將臨時基礎率限制為 x U/h。 建議將此設為合理的數值。 一個好的建議是將設定檔中的最高基礎率乘以 4，並至少乘以 3。 例如，如果設定檔中的最高基礎率是 1.0 U/h，你可以將其乘以 4，得到 4 U/h，並將該數值設為安全參數。

你不能選擇任何數值：出於安全原因，存在一個“硬體限制”，該限制依據病人的年齡。 AMA 模式中的 maxIOB 限制低於 SMB 模式。 對於兒童，該值是最低的，而對於胰島素抗性成人，他是最大的。

在**AAPS**中的硬編碼參數為：

- 兒童：2
- 青少年：5
- 成人：10
- 胰島素抗性成人：12
- 孕婦：25

*請參閱 [硬性限制概述](#overview-of-hard-coded-limits)。*

### OpenAPS 可注射的最大基礎 IOB [U]（OpenAPS "最大 IOB"）

此參數限制了基礎 IOB 的最大值，當**AAPS**仍能運作時。 如果 IOB 高於該數值，則停止注射基礎胰島素，直到 IOB 降至限制值以下。

預設值為 2，但你應該慢慢提高此參數，以查看其對你的影響和最適合的數值。 每個人都不同，這也可能取決於每日總劑量 (TDD) 的平均值。 為了安全考量，此限制會根據患者的年齡而有所不同。 AMA 模式中的 maxIOB 限制低於 SMB 模式。

- 兒童：3
- 青少年：5
- 成人：7
- 胰島素抗性成人：12
- 孕婦：25

*請參閱 [硬性限制概述](#overview-of-hard-coded-limits)。*

### 啟用 AMA Autosens

在這裡，你可以選擇是否要使用[敏感度檢測](../DailyLifeWithAaps/SensitivityDetectionAndCob.md)的自動敏感度調整。

### Autosens 也調整臨時目標

如果啟用了此選項，autosens 可以調整臨時目標（除了基礎率和 ISF）。 這使得**AAPS**能夠更“積極”或"不積極"的運作。 這樣可以更快地達到實際目標。

### 進階設定

- 通常你無需更改此對話框中的設定！
- 如果你仍然想要更改，請務必閱讀[OpenAPS 文件](https://openaps.readthedocs.io/en/latest/docs/While%20You%20Wait%20For%20Gear/preferences-and-safety-settings.html#)，並了解你在做什麼。

**總是使用短期平均變化率而非簡單資料** 如果你啟用此功能，**AAPS** 將使用過去 15 分鐘內的短期平均變化率/血糖，這通常是最後三個數值的平均值。 這有助於**AAPS**在處理像 xDrip+ 和 Libre 這樣的干擾資料來源時更加穩定。

**每日安全倍數上限** 這是一個重要的安全限制。 預設值為 3（通常不需要調整）。 這意味著**AAPS**將永遠不能設定超過用戶的幫浦中編程的最高每小時基礎率 3 倍的臨時基礎率。 舉例來說：如果你的最高基礎率是 1.0 U/h ，且每日安全增益上限為 3，那麼**AAPS**可以設定的臨時基礎率上限為 3.0 U/h (= 3 x 1.0 U/h)。

預設值：3（除非你確實知道需要更改，否則不應更改此設定）。

**目前基礎率安全倍數** 這是另一個重要的安全限制。 預設值為 4（通常也不需要調整）。 這意味著**AAPS**將永遠不能設定超過用戶的幫浦中編程的當前每小時基礎率 4 倍的臨時基礎率。

預設值：4（除非你確實知道需要更改，否則不應更改此設定）。

**注射休眠 DIA 除數** 「注射休眠」功能在餐後注射胰島素後啟用。 **AAPS**在餐後的 DIA 除以“注射休眠”參數期間不會設定低的臨時基礎率。 預設值為 2。 這意味著如果 DIA 為 5 小時，「注射休眠」將持續 5 小時：2 = 2.5 小時。

預設值：2

* * *

(Open-APS-features-overview-of-hard-coded-limits)=

## 硬性限制總覽

|                     | 兒童  | 青少年 | 成人  | 胰島素抗性成人 | 孕婦  |
| ------------------- | --- | --- | --- | ------- | --- |
| 最大注射量 (MAXBOLUS)    | 5   | 10  | 17  | 25      | 60  |
| 最小作用時間 (MINDIA)     | 5   | 5   | 5   | 5       | 5   |
| 最大作用時間 (MAXDIA)     | 9   | 9   | 9   | 9       | 10  |
| 最小碳水比 (MINIC)       | 2   | 2   | 2   | 2       | 0.3 |
| 最大碳水比 (MAXIC)       | 100 | 100 | 100 | 100     | 100 |
| 最大 IOB (MAXIOB_AMA) | 3   | 5   | 7   | 12      | 25  |
| 最大 IOB (MAXIOB_SMB) | 7   | 13  | 22  | 30      | 70  |
| 最大基礎率 (MAXBASAL)    | 2   | 5   | 10  | 12      | 25  |